{{- $cells := slice -}}
{{- $lines := slice -}}
{{- $brokenlines := split (.content) "<" -}}
{{- $line := "" -}}
{{- $level := 0 -}}
{{- range $brokenlines -}}
    {{- $line_start := (substr $line 0 6 ) -}}
    {{- $line_end := (trim . "/") -}}
    {{- $line_end = split $line_end ">" -}}
    {{- $line_end = index $line_end 0 -}}
    {{- $line_end = split $line_end " " -}}
    {{- $line_end = index $line_end 0 -}}
    {{- $match := false -}}
    {{- if and . (in $line_start $line_end)  -}}
        {{- if in . "/" -}}
          {{- $match = true -}}
          {{- if gt $level 0 -}}
            {{- $level = sub $level 1 -}}
          {{- end -}}
        {{- else -}}
          {{- $level = add $level 2 -}}
        {{- end -}}
    {{- end -}}
    {{- if and (eq $level 0) $match -}}
      {{- $line = printf "%s<%s" $line . -}}
      {{- $lines = $lines | append $line -}}
      <br>{{$line}}<br><br>
      {{- $line = "" -}}
    {{- else if . -}}
      {{- $line = printf "%s<%s" $line . -}}
    {{- end -}}
{{- end -}}

{{- $cell := "" -}}
{{- range $lines -}}
  {{- if in . "<style>" -}}
      {{- $cell = . -}}
  {{- else if in . "<h4" -}}
      {{- $cell = . -}}
  {{- else -}}
      {{- $cell = printf "%s%s" $cell . -}}
      {{- $cells = $cells | append $cell -}}
      {{- $cell = "" -}}
  {{- end -}}
{{- end -}}

{{- return $cells -}}
